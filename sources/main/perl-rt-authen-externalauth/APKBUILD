# Automatically generated by apkbuild-cpan, template 1
# Maintainer: Leonardo Arena <rnalrd@alpinelinux.org>
pkgname=perl-rt-authen-externalauth
_realname=RT-Authen-ExternalAuth
pkgver=0.25
pkgrel=0
pkgdesc="RT Authentication using External Sources"
url="http://search.cpan.org/~tsibley"
arch="noarch"
license="GPL PerlArtistic"
cpandepends=""
cpanmakedepends="   "
depends="$cpandepends rt4 perl-dbi perl-ldap perl-net-ssleay"
makedepends="perl-dev $cpanmakedepends"
subpackages="$pkgname-doc"
source="http://search.cpan.org/CPAN/authors/id/F/FA/FALCONE/${_realname}-${pkgver}.tar.gz
	01-fix-plugindir.patch
	"

_builddir="$srcdir/$_realname-$pkgver"

prepare() {
	cd "$_builddir"
        for i in $source; do
                case $i in
		*.patch)
			msg "Applying $i"
			patch -p1 -i "$srcdir"/$i || return 1
			;;
		esac
	done

	export CFLAGS=`perl -MConfig -E 'say $Config{ccflags}'`
	export PREFIX="/usr/lib/rt4" \
	 INSTALLDIRS=vendor \
	 DESTDIR="$pkgdir" \
	 RTHOME="/usr/lib/rt4"

	PERL_MM_USE_DEFAULT=1 perl Makefile.PL \
	 INSTALLDIRS=vendor \
	 DESTDIR="$pkgdir" \
	 RTHOME="/usr/lib/rt4" \
	 PREFIX="/usr/lib/rt4" \
	 INSTALLSITEARCH="/usr/share/man" \
	 INSTALLVENDORMAN1DIR="/usr/share/man/man1" \
	 INSTALLVENDORMAN3DIR="/usr/share/man/man3" \
	 INSTALLVENDORLIB="/usr/share/perl5/vendor_perl"

}

build() {
	cd "$_builddir"
	export CFLAGS=`perl -MConfig -E 'say $Config{ccflags}'`
	make DESTDIR="$pkgdir" \
		RTHOME="/usr/lib/rt4" \
		PREFIX="/usr/lib/rt4"
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" \
		RTHOME="/usr/lib/rt4" \
		PREFIX="/usr/lib/rt4" \
		install || return 1
	mkdir -p "$pkgdir"/etc/rt4/plugins
	find "$pkgdir" \( -name perllocal.pod -o -name .packlist \) -delete
	# leftover empty dirs
	rm -rf "$pkgdir"/home
}

md5sums="18563039f685cddb30259b8869682cac  RT-Authen-ExternalAuth-0.25.tar.gz
bb86eb8fa789153221b020ab8ccb6ac4  01-fix-plugindir.patch"
sha256sums="ac22f33429af4b53c2a487a3fded19becc79ad538ca35753ec5fa3de27f5911c  RT-Authen-ExternalAuth-0.25.tar.gz
e77b19ce51ab2ac1028d2d616d2dccaaefdf2fe0c4c83bd166b06887be1b93b5  01-fix-plugindir.patch"
sha512sums="82306cb4c483bace0e209eecd9b033fd97e57dcd424a4fd56cefb5e7fa7592078078a896c2e0e604547188f198876a03c72be80afcdf058bdcd351ea55687d26  RT-Authen-ExternalAuth-0.25.tar.gz
39411a0e0e3a8cc3de2386192e015bcc1044f529e814b5540df405e1b88b4a1569199d84afacaa78467c9d01b44060c02691777c0e9f013a527b0cd5782620ac  01-fix-plugindir.patch"
